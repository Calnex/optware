#! /bin/sh

#########
if [ -z "$1" ] ; then
    case `echo "$0" | /bin/sed 's:^.*/\(.*\):\1:g'` in
        S??*) rc="start" ;;
        K??*) rc="stop" ;;
        *) rc="usage" ;;
    esac
else
    rc="$1"
fi

case "$rc" in
    add)
        REPO=`find /media -type f -name Packages.gz | sed 's/Packages.gz/\*/g'`
        su calnex -c mkdir -p /tmp/optware-repo
        su calnex -c cp $REPO /tmp/optware-repo/
        su calnex -c echo "src/gz local file:////tmp/optware-repo"		> /opt/etc/ipkg/cross-feed.conf
        ;;
    remove)
        su calnex -c rm -rf /tmp/optware-repo
	su calnex -c echo "src/gz cross http://packages.calnexsol.com"       > /opt/etc/ipkg/cross-feed.conf
        ;;
    *)
        echo "Usage: $0 (install|remove)"
        ;;
esac
